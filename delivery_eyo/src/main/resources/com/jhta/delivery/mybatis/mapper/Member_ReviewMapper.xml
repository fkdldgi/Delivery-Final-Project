<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.Member_ReviewMapper">
	<!-- 가게 번호로 가게의 리뷰 리스트 가져오기 -->
	<select id="shopReviewList" parameterType="int" resultType="com.jhta.delivery.vo.ReviewVo">
		select * from review where shop_num=#{shop_num} and ref=0 and lev=0 order by num desc
	</select>
	
	<!-- 리뷰에 대한 이미지 리스트 가져오기 -->
	<select id="reviewImgList" resultType="com.jhta.delivery.vo.Review_ImgVo">
		select * from review_img
	</select>

	<!-- 고객번호와 가게번호를 받아 리뷰작성 조건 판단하기 -->
	<select id="reviewAble" parameterType="hashmap" resultType="String">
		select NVL(1,0) chk
		from ORDER_MAIN,ORDER_TRANSACTION
		where (select num from ORDER_MAIN where member_num=#{member_num}) = (select order_num from ORDER_TRANSACTION where shop_num=#{shop_num})
	</select>
	
	<!-- 주문한 고객이 리뷰를 썼는지 -->
	<select id="selectMemberReview" parameterType="hashmap" resultType="com.jhta.delivery.vo.ReviewVo">
		select * from REVIEW where member_num=#{member_num} and shop_num=#{shop_num}
	</select>
</mapper>